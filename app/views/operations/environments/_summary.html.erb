<%= section_panel 'Status', :id => 'status_section', :width => 'double', :position => 'left' do %>
  <%= render :partial => 'status' %>
<% end %>

<div class="cost-summary">
  <script>
    <%= remote_function(:url => cost_rate_assembly_operations_environment_path(@assembly, @environment), :method => :get) %>
  </script>
</div>

<%= section_panel 'Platforms', :id => 'platforms_list', :width => 'single', :position => 'right' do %>
  <% ci_relation_map = @platforms.inject({}) { |map, r| map[r.toCiId] = r; map } %>
  <%= ci_list(@platforms.map(&:toCi), :new_path => nil) do |builder, target| %>
    <% relation = ci_relation_map[target.ciId] %>
    <% builder.target link_to('', assembly_operations_environment_platform_path(@assembly, @environment, target)) %>
    <% builder.icon platform_image_url(target) %>
    <% enabled = relation.relationAttributes.enabled == 'true' %>
    <% active = target.ciAttributes.attributes.has_key?(:is_active) && target.ciAttributes.is_active != 'true' ? false : true %>
    <% builder.status do %>
      <%= status_marker('version', "#{target.ciAttributes.major_version}", active ? 'label-success' : '') %>
      <%= status_marker('release', target.rfcAction, action_to_label(target.rfcAction)) if target.respond_to?(:rfcAction) && target.rfcAction %>
      <%= marker('disabled', 'label-important') unless enabled %>
      <%= instance_marker(@platform_clouds, target) %>
      <%= icon('star') %>
      <%= icon('star') if target.ciAttributes.availability == 'redundant' %>
    <% end %>
    <% builder.top do %>
      <span class="topname"><%= target.ciName %></span>
    <% end %>
    <% builder.middle target.ciAttributes.description %>
  <% end %>
<% end %>

<%= section_panel 'Recent Notifications',
                  :id       => 'summary_notifications',
                  :width    => 'double',
                  :position => 'left',
                  :menu     => [link_to(icon('filter', 'filter'), notification_reports_path(:period => 'this week', :path => environment_ns_path(@environment)), :class => 'btn btn-mini')] do %>
  <%= notification_list @notifications, :toolbar => nil %>
<% end %>
